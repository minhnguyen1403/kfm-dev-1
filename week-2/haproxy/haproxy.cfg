# global
#     log /dev/log    local0
#     log /dev/log    local1 notice
#     chroot /var/lib/haproxy
#     stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
#     stats timeout 30s
#     user haproxy
#     group haproxy
#     daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 10s
    timeout client  60s
    timeout server  60s
    errorfile 400 /etc/haproxy/errors/400.http
    errorfile 403 /etc/haproxy/errors/403.http
    errorfile 408 /etc/haproxy/errors/408.http
    errorfile 500 /etc/haproxy/errors/500.http
    errorfile 502 /etc/haproxy/errors/502.http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 504 /etc/haproxy/errors/504.http

# backend api
#     mode http
#     option httplog
#     option forwardfor
#     server api localhost:3000

# backend bangphongthan
#     mode http
#     option httplog
#     option forwardfor
#     server bangphongthan localhost:8080

# backend ditre
#     mode http
#     option httplog
#     option forwardfor
#     server ditre localhost:8081
#     use_backend api if api

backend bangphongthan
    balance roundrobin
    server bangphongthan localhost:8080 check
backend ditre
    balance roundrobin
    server ditre localhost:8081 check
backend api
    balance roundrobin
    server api localhost:3000 check

frontend http_in
    bind :80
    # bangphongthan
    acl ACL_bangphongthan hdr(host) -i bangphongthan.localhost
    use_backend bangphongthan if ACL_bangphongthan
    # ditre
    acl ACL_ditre hdr(host) -i ditre.localhost
    use_backend ditre if ACL_ditre
    # bangphongthan
    acl ACL_api hdr(host) -i api.localhost
    use_backend api if ACL_api
